---
- name: Wait for ssh connection
  hosts: all
  gather_facts: False
  tasks:
    - name: Ensure SSH port is open
      wait_for:
        port: 22
        delay: 10
        timeout: 120
        host:  '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}'
      vars:
        ansible_connection: local

- name: Install dependencies
  hosts: all
  become: yes 
  tasks:
  - name: Make sure git is installed
    vars:
      ansible_python_interpreter: /usr/bin/python
    yum:
      name: 
        - git
      state: latest
      update_cache: yes

# Done as ec2-user. If the destination requires root
# permissions, uncomment the line 'become: yes'
# Note that root will then own the repo, so you may
# want to change the owner/permissions afterwards
- name: Clone git repo
  hosts: all
  #become: yes # do these tasks as root 
  tasks:
  - name: Clone repo
    ansible.builtin.git:
      repo: '{{repo_url}}'
      dest: '{{dest_dir}}'